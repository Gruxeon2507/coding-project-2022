local Ease3D = require(script:GetCustomProperty("Ease3D"))
local ProspectingManager = require(script:GetCustomProperty("ProspectingManager"))
local GameManager = require(script:GetCustomProperty("GameManager"))

local Thumper_Explosion = script:GetCustomProperty("Thumper_Explosion")


local SFX = script:GetCustomProperty("SFX"):WaitForObject():GetChildren()
local VFX = script:GetCustomProperty("VFX"):WaitForObject():GetChildren()

local PROSPECTING_DRILL_ROOT = script:GetCustomProperty("ProspectingDrillClient"):WaitForObject()
local ROOT_PIVOT = script:GetCustomProperty("Geo_Pivot"):WaitForObject()
local ROOT_ROTATOR = script:GetCustomProperty("Geo_Rotator"):WaitForObject()
local ROOT = script:GetCustomProperty("ROOT"):WaitForObject()
local ExtenderGeo = script:GetCustomProperty("ExtenderGeo"):WaitForObject()
local Rotator_Pivot = script:GetCustomProperty("Rotator_Pivot"):WaitForObject()
local Rotator = script:GetCustomProperty("Rotator"):WaitForObject()
local Drill_Pivot = script:GetCustomProperty("Drill_Pivot"):WaitForObject()
local Drill = script:GetCustomProperty("Drill"):WaitForObject()
local LaserReciever_Pivot = script:GetCustomProperty("LaserReciever_Pivot"):WaitForObject()
local LaserReciever = script:GetCustomProperty("LaserReciever"):WaitForObject()
local Thumper = script:GetCustomProperty("Thumper"):WaitForObject()
local ArmPivot_01 = script:GetCustomProperty("ArmPivot_01"):WaitForObject()
local ArmPivot_02 = script:GetCustomProperty("ArmPivot_02"):WaitForObject()
local ArmPivot_03 = script:GetCustomProperty("ArmPivot_03"):WaitForObject()
local ArmPivot_04 = script:GetCustomProperty("ArmPivot_04"):WaitForObject()
local ArmEnd_01 = script:GetCustomProperty("ArmEnd_01"):WaitForObject()
local ArmEnd_02 = script:GetCustomProperty("ArmEnd_02"):WaitForObject()
local ArmEnd_03 = script:GetCustomProperty("ArmEnd_03"):WaitForObject()
local ArmEnd_04 = script:GetCustomProperty("ArmEnd_04"):WaitForObject()
local LegPivot_01 = script:GetCustomProperty("LegPivot_01"):WaitForObject()
local LegPivot_02 = script:GetCustomProperty("LegPivot_02"):WaitForObject()
local LegPivot_03 = script:GetCustomProperty("LegPivot_03"):WaitForObject()
local LegPivot_04 = script:GetCustomProperty("LegPivot_04"):WaitForObject()
local FlameJet = script:GetCustomProperty("FlameJet"):WaitForObject()
local FlameJet_Smoke = script:GetCustomProperty("FlameJet_Smoke"):WaitForObject()

--Jet Thruster VFX on end arm pivots
local Flames_01 = script:GetCustomProperty("Flames_01"):WaitForObject()
local Flames_02 = script:GetCustomProperty("Flames_02"):WaitForObject()
local Flames_03 = script:GetCustomProperty("Flames_03"):WaitForObject()
local Flames_04 = script:GetCustomProperty("Flames_04"):WaitForObject()
local Flames_05 = script:GetCustomProperty("Flames_05"):WaitForObject()
local Flames_06 = script:GetCustomProperty("Flames_06"):WaitForObject()
local Flames_07 = script:GetCustomProperty("Flames_07"):WaitForObject()
local Flames_08 = script:GetCustomProperty("Flames_08"):WaitForObject()


local SKIP_DROP_ANIMATION = script:GetCustomProperty("SkipDropAnimation")

local spot = ProspectingManager.GetSpot(script:GetWorldPosition())
local machine = spot:WaitForMachine()

local waveManager = nil
local explosionPosition = Vector3.ZERO

local thumpingTask = nil

local function ProspectingMachineDeployment()
    pcall(function()
        if not SKIP_DROP_ANIMATION then
            Task.Spawn (function()
            --Used to add SFX overlay for jet thrusters when landing.
            Task.Wait(8.30)
            Flames_01:Play()
            Flames_02:Play()
            Flames_03:Play()
            Flames_04:Play()
            Flames_05:Play()
            Flames_06:Play()
            Flames_07:Play()
            Flames_08:Play()
            SFX[22]:Play()
            Task.Wait(0.25)
            Ease3D.EaseScale(Flames_01, Flames_01:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_02, Flames_02:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_03, Flames_03:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_04, Flames_04:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_05, Flames_05:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_06, Flames_06:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_07, Flames_07:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_08, Flames_08:GetScale() + Vector3.UP * 1, 1, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Task.Wait(0.75)
            Ease3D.EaseScale(Flames_01, Flames_01:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_02, Flames_02:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_03, Flames_03:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_04, Flames_04:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_05, Flames_05:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_06, Flames_06:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_07, Flames_07:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Ease3D.EaseScale(Flames_08, Flames_08:GetScale() + Vector3.UP * -1.5, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
            Task.Wait(0.5)
            Flames_01:Stop()
            Flames_02:Stop()
            Flames_03:Stop()
            Flames_04:Stop()
            Flames_05:Stop()
            Flames_06:Stop()
            Flames_07:Stop()
            Flames_08:Stop()
            end)
            Task.Wait(8)
            SFX[13]:Play()
            Ease3D.EasePosition(ROOT, ROOT:GetPosition() + Vector3.UP * -30000, 1, Ease3D.EasingEquation.LINEAR, Ease3D.EasingEquation.OUT)
            Task.Wait(1)
            Ease3D.EaseRotation(ArmPivot_01, ArmPivot_01:GetRotation() + Rotation.New(0,-5,0), 0.3, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
            Ease3D.EaseRotation(ArmPivot_02, ArmPivot_02:GetRotation() + Rotation.New(0,-5,0), 0.3, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
            Ease3D.EaseRotation(ArmPivot_03, ArmPivot_03:GetRotation() + Rotation.New(0,-5,0), 0.4, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
            Ease3D.EaseRotation(ArmPivot_04, ArmPivot_04:GetRotation() + Rotation.New(0,5,0), 0.3, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
            SFX[1]:Play()
            SFX[2]:Play()
            SFX[3]:Play()
            VFX[1]:Play()
            VFX[2]:Play()
            VFX[3]:Play()
            Task.Wait(1.5)
            Ease3D.EaseRotation(ArmPivot_01, ArmPivot_01:GetRotation() + Rotation.New(0,5,0), 1.5, Ease3D.EasingEquation.CUBIC, Ease3D.EasingEquation.OUT)
            Ease3D.EaseRotation(ArmPivot_02, ArmPivot_02:GetRotation() + Rotation.New(0,5,0), 1.5, Ease3D.EasingEquation.CUBIC, Ease3D.EasingEquation.OUT)
            Ease3D.EaseRotation(ArmPivot_03, ArmPivot_03:GetRotation() + Rotation.New(0,5,0), 1.5, Ease3D.EasingEquation.CUBIC, Ease3D.EasingEquation.OUT)
            Ease3D.EaseRotation(ArmPivot_04, ArmPivot_04:GetRotation() + Rotation.New(0,-5,0), 1.5, Ease3D.EasingEquation.CUBIC, Ease3D.EasingEquation.OUT)
            SFX[8]:Play()
        end
        Ease3D.EaseRotation(LegPivot_01, LegPivot_01:GetRotation() + Rotation.New(0,-100,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(LegPivot_02, LegPivot_02:GetRotation() + Rotation.New(0,100,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(LegPivot_03, LegPivot_03:GetRotation() + Rotation.New(0,-100,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(LegPivot_04, LegPivot_04:GetRotation() + Rotation.New(0,100,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Task.Wait(0.75)
        Ease3D.EasePosition(ROOT, ROOT:GetPosition() + Vector3.UP * 60, 2, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
        Task.Wait(2)
        SFX[9]:Play()
        --Helps create SFX overlap in animations
        Task.Spawn (function()
            SFX[4]:Play()
            Task.Wait(3.1)
            SFX[10]:Play()
            Task.Wait(1)
            SFX[7]:Play()
            Task.Wait(0.3)
            SFX[11]:Play()
        end, 1.3)
        Ease3D.EaseRotation(ArmPivot_01, ArmPivot_01:GetRotation() + Rotation.New(0,-30,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmPivot_02, ArmPivot_02:GetRotation() + Rotation.New(0,-30,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmPivot_03, ArmPivot_03:GetRotation() + Rotation.New(0,-30,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmPivot_04, ArmPivot_04:GetRotation() + Rotation.New(0,30,0), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Task.Wait(1.5)
        Ease3D.EaseRotation(ArmEnd_01, ArmEnd_01:GetRotation() + Rotation.New(0,20,0), 3, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_02, ArmEnd_02:GetRotation() + Rotation.New(0,20,0), 3, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_03, ArmEnd_03:GetRotation() + Rotation.New(0,20,0), 3, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_04, ArmEnd_04:GetRotation() + Rotation.New(0,20,0), 3, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Task.Wait(3.2)
        Ease3D.EaseRotation(ArmEnd_01, ArmEnd_01:GetRotation() + Rotation.New(0,10,0), 1.5, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_02, ArmEnd_02:GetRotation() + Rotation.New(0,10,0), 1.5, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_03, ArmEnd_03:GetRotation() + Rotation.New(0,10,0), 1.5, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_04, ArmEnd_04:GetRotation() + Rotation.New(0,10,0), 1.5, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Task.Wait(0.5)
        Ease3D.EasePosition(LaserReciever, LaserReciever:GetPosition() + Vector3.UP * 70, 1, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.IN)
        Task.Wait(4)
        SFX[15]:Play()
        Ease3D.EasePosition(Drill_Pivot, Drill_Pivot:GetPosition() + Vector3.UP * -50, 1, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.IN)
        Ease3D.EaseRotation(Drill, Drill:GetRotation() + Rotation.New(0,0,1500), 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Task.Wait(2)
        if not machine:IsCapacityFilled() then
            Drill_Pivot:RotateContinuous(Rotation.New(0, 0, 5000))
            VFX[4]:Play()
            VFX[5]:Play()
            VFX[6]:Play()
            SFX[14]:Play()
            SFX[16]:Play()
            Task.Wait(1)
            thumpingTask = Task.Spawn(function()
                if Object.IsValid(ROOT) then
                    Ease3D.EasePosition(ROOT, ROOT:GetPosition() + Vector3.UP * -3, 0.05, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
                    Ease3D.EasePosition(Thumper, Thumper:GetPosition() + Vector3.UP * -80, 0.10, Ease3D.EasingEquation.LINEAR, Ease3D.EasingEquation.IN)
                    SFX[28]:Play()
                    VFX[15]:Play()
                end
                Task.Wait(0.25)
                if Object.IsValid(ROOT) then
                    Ease3D.EasePosition(ROOT, ROOT:GetPosition() + Vector3.UP * 3, 0.22, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
                    Ease3D.EasePosition(Thumper, Thumper:GetPosition() + Vector3.UP * 80, 0.7, Ease3D.EasingEquation.LINEAR, Ease3D.EasingEquation.OUT)
                end
            end)
            thumpingTask.repeatCount = -1
            thumpingTask.repeatInterval = 1
        end
    end)
end

local function StopMining()
    if thumpingTask then
        Task.Spawn (function()
            Task.Wait(1)
            SFX[20]:Play()
        end)
        thumpingTask:Cancel()
        thumpingTask = nil
        Drill_Pivot:RotateContinuous(Rotation.New(0, 0, 1000))
        Task.Wait()
        VFX[4]:Stop()
        VFX[5]:Stop()
        VFX[6]:Stop()
        SFX[4]:Play()
        SFX[14]:Stop()
        SFX[16]:Stop()
        Ease3D.EaseRotation(ArmPivot_01, ArmPivot_01:GetRotation() + Rotation.New(0,30,0), 2.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmPivot_02, ArmPivot_02:GetRotation() + Rotation.New(0,30,0), 2.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmPivot_03, ArmPivot_03:GetRotation() + Rotation.New(0,30,0), 2.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmPivot_04, ArmPivot_04:GetRotation() + Rotation.New(0,-30,0), 2.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(Rotator_Pivot, Rotator_Pivot:GetRotation() + Rotation.New(0,0,45), 3, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EasePosition(Drill_Pivot, Drill_Pivot:GetPosition() + Vector3.UP * 50, 2, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.IN)
        Task.Wait(1.0)
        Drill_Pivot:RotateContinuous(Rotation.New(0, 0, 500))
        SFX[9]:Play()
        Ease3D.EaseRotation(ArmEnd_01, ArmEnd_01:GetRotation() + Rotation.New(0,-50,0), 1, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_02, ArmEnd_02:GetRotation() + Rotation.New(0,-50,0), 1, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_03, ArmEnd_03:GetRotation() + Rotation.New(0,-50,0), 1, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ArmEnd_04, ArmEnd_04:GetRotation() + Rotation.New(0,-50,0), 1, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
        Task.Wait(1.5)
        Drill_Pivot:RotateContinuous(Rotation.New(0, 0, 0))
        SFX[11]:Play()
    end
end

local function GameCompleteAnimation()
    if thumpingTask then
        thumpingTask:Cancel()
        thumpingTask = nil
    end
    Task.Spawn (function()
        Task.Wait(1.15)
        SFX[10]:Play()
        Task.Wait(1.4)
        SFX[17]:Play()
        Task.Wait(0.2)
        SFX[6]:Play()
        Task.Wait(0.1)
        SFX[18]:Play()
        Task.Wait(0.2)
        Flames_01:Stop()
        Flames_02:Stop()
        Flames_03:Stop()
        Flames_04:Stop()
        Flames_05:Stop()
        Flames_06:Stop()
        Flames_07:Stop()
        Flames_08:Stop()
        Task.Wait(0.55)
        Flames_01:Stop()
        Flames_02:Stop()
        Flames_03:Stop()
        Flames_04:Stop()
        Flames_05:Stop()
        Flames_06:Stop()
        Flames_07:Stop()
        Flames_08:Stop()
        Task.Wait(0.55)
        Flames_01:Stop()
        Flames_02:Stop()
        Flames_03:Stop()
        Flames_04:Stop()
        Flames_05:Stop()
        Flames_06:Stop()
        Flames_07:Stop()
        Flames_08:Stop()
        Task.Wait(0.55)
    end)
    Task.Wait(1)
    Ease3D.EaseRotation(LaserReciever, LaserReciever:GetRotation() + Rotation.New(0,0,600), 2, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
    Task.Wait(1.5)
    VFX[7]:Play()
    Ease3D.EasePosition(LaserReciever_Pivot, LaserReciever_Pivot:GetPosition() + Vector3.UP * -50, 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
    Task.Wait(0.2)
    SFX[19]:Play()
    Ease3D.EasePosition(Drill_Pivot, Drill_Pivot:GetPosition() + Vector3.UP * 100, 3, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.IN)
    Ease3D.EasePosition(ExtenderGeo, ExtenderGeo:GetPosition() + Vector3.UP * -50, 0.75, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.IN)
    Ease3D.EaseRotation(ArmPivot_01, ArmPivot_01:GetRotation() + Rotation.New(0,-5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmPivot_02, ArmPivot_02:GetRotation() + Rotation.New(0,-5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmPivot_03, ArmPivot_03:GetRotation() + Rotation.New(0,-5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmPivot_04, ArmPivot_04:GetRotation() + Rotation.New(0,5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Task.Wait()
    SFX[21]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Ease3D.EaseScale(FlameJet, FlameJet:GetScale() + Vector3.UP * 1, 0.3, Ease3D.EasingEquation.LINEAR, Ease3D.EasingEquation.IN)
    Task.Wait(0.55)
    SFX[21]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Task.Wait(0.55)
    SFX[21]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Task.Wait(0.55)
    SFX[22]:Play()
    SFX[29]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Ease3D.EaseScale(Flames_01, Flames_01:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_02, Flames_02:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_03, Flames_03:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_04, Flames_04:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_05, Flames_05:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_06, Flames_06:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_07, Flames_07:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_08, Flames_08:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    FlameJet:Play()
    FlameJet_Smoke:Play()
    Ease3D.EasePosition(ROOT, ROOT:GetPosition() + Vector3.UP * 30000, 10, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(LegPivot_01, LegPivot_01:GetRotation() + Rotation.New(0,125,0), 2, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(LegPivot_02, LegPivot_02:GetRotation() + Rotation.New(0,-125,0), 2, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(LegPivot_03, LegPivot_03:GetRotation() + Rotation.New(0,125,0), 2, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(LegPivot_04, LegPivot_04:GetRotation() + Rotation.New(0,-125,0), 2, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(FlameJet, FlameJet:GetScale() + Vector3.UP * 2, 0.3, Ease3D.EasingEquation.LINEAR, Ease3D.EasingEquation.IN)
    Task.Wait(4)
end

local function GameFailureAnimation()
    if thumpingTask then
        thumpingTask:Cancel()
    end
    Task.Spawn (function()
        Task.Wait(0.2)
        Flames_01:Stop()
        Flames_02:Stop()
        Flames_03:Stop()
        Flames_04:Stop()
        Flames_05:Stop()
        Flames_06:Stop()
        Flames_07:Stop()
        Flames_08:Stop()
        Task.Wait(0.55)
        Flames_01:Stop()
        Flames_02:Stop()
        Flames_03:Stop()
        Flames_04:Stop()
        Flames_05:Stop()
        Flames_06:Stop()
        Flames_07:Stop()
        Flames_08:Stop()
        Task.Wait(0.55)
        Flames_01:Stop()
        Flames_02:Stop()
        Flames_03:Stop()
        Flames_04:Stop()
        Flames_05:Stop()
        Flames_06:Stop()
        Flames_07:Stop()
        Flames_08:Stop()
        Task.Wait(0.55)
    end)
    VFX[4]:Stop()
    VFX[5]:Stop()
    VFX[6]:Stop()
    SFX[14]:Stop()
    SFX[16]:Stop()
    SFX[25]:Play()
    SFX[27]:Play()
    VFX[12]:Play()
    Drill_Pivot:RotateContinuous(Rotation.New(0, 0, 0))
    Ease3D.EasePosition(ExtenderGeo, ExtenderGeo:GetPosition() + Vector3.UP * -30, 0.75, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.IN)
    Ease3D.EaseRotation(ArmPivot_01, ArmPivot_01:GetRotation() + Rotation.New(0,-5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmPivot_02, ArmPivot_02:GetRotation() + Rotation.New(0,-5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmPivot_03, ArmPivot_03:GetRotation() + Rotation.New(0,-5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmPivot_04, ArmPivot_04:GetRotation() + Rotation.New(0,5,0), 0.5, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Task.Wait()
    Ease3D.EasePosition(Drill_Pivot, Drill_Pivot:GetPosition() + Vector3.UP * 40, 1, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.IN)
    SFX[21]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Ease3D.EaseScale(FlameJet, FlameJet:GetScale() + Vector3.UP * 1, 0.3, Ease3D.EasingEquation.LINEAR, Ease3D.EasingEquation.IN)
    Task.Wait(0.55)
    SFX[21]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Task.Wait(0.55)
    SFX[21]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Task.Wait(0.55)
    SFX[22]:Play()
    SFX[29]:Play()
    Flames_01:Play()
    Flames_02:Play()
    Flames_03:Play()
    Flames_04:Play()
    Flames_05:Play()
    Flames_06:Play()
    Flames_07:Play()
    Flames_08:Play()
    Ease3D.EaseScale(Flames_01, Flames_01:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_02, Flames_02:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_03, Flames_03:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_04, Flames_04:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_05, Flames_05:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_06, Flames_06:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_07, Flames_07:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Ease3D.EaseScale(Flames_08, Flames_08:GetScale() + Vector3.UP * 1.50, 0.25, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    FlameJet:Play()
    FlameJet_Smoke:Play()
    Ease3D.EasePosition(ROOT_PIVOT, ROOT_PIVOT:GetPosition() + Vector3.UP * 2000, 10, Ease3D.EasingEquation.EXPONENTIAL, Ease3D.EasingEquation.OUT)
    Task.Wait(0.5)
    SFX[26]:Play()
    SFX[23]:Play()
    VFX[10]:Play()
    VFX[11]:Play()
    VFX[13]:Play()
    Ease3D.EaseRotation(LaserReciever, LaserReciever:GetRotation() + Rotation.New(0,0,1000), 1, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmEnd_01, ArmEnd_01:GetRotation() + Rotation.New(0,-14,0), 2, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmEnd_02, ArmEnd_02:GetRotation() + Rotation.New(0,5,0), 1, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmEnd_03, ArmEnd_03:GetRotation() + Rotation.New(0,15,0), 1.5, Ease3D.EasingEquation.BOUNCE, Ease3D.EasingEquation.OUT)
    Ease3D.EaseRotation(ArmEnd_04, ArmEnd_04:GetRotation() + Rotation.New(0,20,0), 2.3, Ease3D.EasingEquation.BACK, Ease3D.EasingEquation.OUT)
    explosionPosition = ExtenderGeo:GetWorldPosition()
    Task.Wait(0.1)
    SFX[23]:Play()
    SFX[24]:Play()
    VFX[14]:Play()
    VFX[10]:Play()
    Task.Wait(0.3)
    SFX[21]:Play()
    VFX[10]:Play()
    VFX[11]:Play()
    VFX[12]:Play()
    VFX[14]:Play()
    Task.Wait(2)
    if Object.IsValid(ROOT) then
        Ease3D.EaseRotation(ROOT, ROOT:GetRotation() + Rotation.New(0,100,math.random(60,120)), 6, Ease3D.EasingEquation.QUADRATIC, Ease3D.EasingEquation.OUT)
        Ease3D.EaseRotation(ROOT_ROTATOR, ROOT_ROTATOR:GetRotation() + Rotation.New(0,100,math.random(0,360)), math.random(28,40), Ease3D.EasingEquation.QUADRATIC, Ease3D.EasingEquation.OUT)
    end

    Task.Wait(3)
    if Object.IsValid(ROOT) then
        World.SpawnAsset(Thumper_Explosion,{
            position = ROOT:GetWorldPosition()
        })
        PROSPECTING_DRILL_ROOT:Destroy()
    end
end

machine.OnDestroy:Connect(function()
    if not waveManager then
        GameCompleteAnimation()
        Task.Wait(7)
        if Object.IsValid(PROSPECTING_DRILL_ROOT) then
            PROSPECTING_DRILL_ROOT:Destroy()
        end
    else
        GameFailureAnimation()
        Task.Wait(8)
        if Object.IsValid(PROSPECTING_DRILL_ROOT) then
            PROSPECTING_DRILL_ROOT:Destroy()
        end
    end
end)

GameManager.OnWaveManagerCreated:Connect(function(manager)
    local owners = machine:GetOwners()
    if owners[1] then
        if manager:IsOwner( owners[1] ) then
            waveManager = manager
            waveManager.GameComplete:Connect(GameCompleteAnimation)
            waveManager.GameFailure:Connect(GameFailureAnimation)
        end
    end
end)

-- Late joining clients
local owners = machine:GetOwners()
if owners[1] then
    waveManager = GameManager.GetWaveManagerFromPlayer(owners[1])
    if waveManager then
        waveManager.GameComplete:Connect(GameCompleteAnimation)
        waveManager.GameFailure:Connect(GameFailureAnimation)
    end
end

ProspectingMachineDeployment()

Task.Wait(1)

if not machine:IsCapacityFilled() then
    machine.OnContainerFilled:Connect(function()
        StopMining()
    end)    
end